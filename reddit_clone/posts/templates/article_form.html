{% load static %}
{% load form_filters %}

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–°—Ç–≤–æ—Ä–∏—Ç–∏ / –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç—Ç—é</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #f5f5f5;
        }
        .form-box {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 12px rgba(0,0,0,0.08);
            margin-top: 40px;
        }

        /* —Å—Ç–∏–ª—ñ —Ç–µ–≥—ñ–≤ */
        .tag {
            display: inline-block;
            background: #0d6efd;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .tag .remove-tag {
            margin-left: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        #tags-container {
            margin-top: 5px;
        }
    </style>
</head>

<body class="container py-4">

    <div class="mb-3">
        <a href="{% url 'article_list' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å—Ç–∞—Ç–µ–π</a>
        <a href="{% url 'feed' %}" class="btn btn-outline-primary ms-2">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
    </div>

    <div class="form-box">
        <h2 class="mb-4">
            {% if form.instance.pk %}
                –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç—Ç—é
            {% else %}
                –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—Ç—é
            {% endif %}
        </h2>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="mb-3">
                <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                {{ form.title|add_class:"form-control" }}
            </div>

            <div class="mb-3">
                <label class="form-label">–¢–µ–∫—Å—Ç</label>
                {{ form.content|add_class:"form-control" }}
            </div>

            <div class="mb-3">
                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                {{ form.category|add_class:"form-select" }}
            </div>

            <!-- –¢–µ–≥–∏ -->
            <div class="mb-3">
                <label class="form-label">–¢–µ–≥–∏</label>

                <!-- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥—É -->
                <input type="text" id="tag-input" class="form-control" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–≥ —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter">

                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ñ–∑—É–∞–ª—å–Ω–∏—Ö —Ç–µ–≥—ñ–≤ -->
                <div id="tags-container"></div>

                <!-- –°—Ö–æ–≤–∞–Ω–µ –ø–æ–ª–µ –¥–ª—è Django -->
                <input type="hidden" name="tags_list" id="tags-hidden">
            </div>

            <div class="mb-3">
                <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                {{ form.status|add_class:"form-select" }}
            </div>

            <!-- –ú–Ω–æ–∂–∏–Ω–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ -->
            <div class="mb-3">
                <label for="id_images" class="form-label">–§–æ—Ç–æ</label>
                <input type="file" name="images" id="id_images" multiple class="form-control">
            </div>

            <!-- –ú–Ω–æ–∂–∏–Ω–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ -->
            <div class="mb-3">
                <label for="id_videos" class="form-label">–í—ñ–¥–µ–æ</label>
                <input type="file" name="videos" id="id_videos" multiple class="form-control">
            </div>

            <button type="submit" class="btn btn-primary w-100">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        </form>
    </div>

    <script>
        const tagInput = document.getElementById("tag-input");
        const tagsContainer = document.getElementById("tags-container");
        const hiddenInput = document.getElementById("tags-hidden");

        let tags = [];

        // –î–æ–¥–∞—î–º–æ —Ç–µ–≥ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ Enter
        tagInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                e.preventDefault();
                const value = tagInput.value.trim();

                if (value !== "" && !tags.includes(value)) {
                    tags.push(value);
                    updateTags();
                }

                tagInput.value = "";
            }
        });

        // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–µ–≥—ñ–≤ —ñ —Å—Ö–æ–≤–∞–Ω–µ –ø–æ–ª–µ
        function updateTags() {
            tagsContainer.innerHTML = "";
            tags.forEach(tag => {
                tagsContainer.innerHTML += `
                    <span class="tag">
                        ${tag}
                        <span class="remove-tag" onclick="removeTag('${tag}')">√ó</span>
                    </span>
                `;
            });

            hiddenInput.value = tags.join(",");
        }

        // –í–∏–¥–∞–ª—è—î–º–æ —Ç–µ–≥
        function removeTag(tag) {
            tags = tags.filter(t => t !== tag);
            updateTags();
        }
    </script>

</body>
</html>
